[supervisord]
nodaemon=true

[program:php-fpm]
command=php-fpm -F
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr

[program:nginx]
command=nginx -g "daemon off;"
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr

[program:migrate]
command=sh -lc 'echo "[migrate] Waiting DB..."; for i in $(seq 1 60); do php bin/console doctrine:query:sql "SELECT 1" >/dev/null 2>&1 && break; echo "[migrate] not ready ($i/60)"; sleep 2; done; php bin/console doctrine:migrations:migrate --no-interaction || true; echo "[migrate] done"'
autorestart=false
startsecs=0
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
